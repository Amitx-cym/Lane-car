<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>5-Lane Car Game</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #333;
    font-family: Arial, sans-serif;
    touch-action: none;
  }
  canvas {
    display: block;
    background: url('road.png') repeat-y center;
    background-size: cover;
  }
  #buttonsDiv {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
    text-align: center;
  }
  button {
    padding: 15px 30px;
    font-size: 18px;
    margin: 5px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    background: #ff6600;
    color: white;
    box-shadow: 2px 2px 6px #000;
  }
  #scoreboard {
    position: absolute;
    top: 10px;
    right: 20px;
    color: white;
    font-size: 22px;
    z-index: 5;
  }
  #leaderboard {
    position: absolute;
    top: 50px;
    right: 20px;
    color: white;
    font-size: 18px;
    z-index: 5;
    display: none;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<div id="buttonsDiv">
  <button id="startBtn">Start Game</button>
  <button id="restartBtn" style="display:none;">Restart Game</button>
</div>

<div id="scoreboard">Score: 0</div>
<div id="leaderboard">
  <h3>Leaderboard</h3>
  <ol id="scoresList"></ol>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let laneCount = 5;
let laneWidth;
let player = {};
let enemies = [];
let spawnTimer;
let enemySpeed = 4;
let spawnInterval = 1500;
let score = 0;
let gameRunning = false;
let highScores = JSON.parse(localStorage.getItem("carGameScores") || "[]");

const startBtn = document.getElementById('startBtn');
const restartBtn = document.getElementById('restartBtn');
const buttonsDiv = document.getElementById('buttonsDiv');
const scoreboard = document.getElementById('scoreboard');
const leaderboardDiv = document.getElementById('leaderboard');
const scoresList = document.getElementById('scoresList');

const playerImg = new Image();
playerImg.src = 'player.png';

const enemyImg = new Image();
enemyImg.src = 'enemy.png';

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  laneWidth = canvas.width / laneCount;
  if(player.x === undefined) {
    player.width = laneWidth * 0.6;
    player.height = laneWidth * 1.2;
    player.lane = 2;
    player.x = player.lane * laneWidth + (laneWidth - player.width)/2;
    player.y = canvas.height - player.height - 20;
  }
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function spawnEnemy() {
  const carWidth = laneWidth * 0.6;
  const carHeight = laneWidth * 1.2;
  const lane = Math.floor(Math.random() * laneCount);
  const enemy = {
    x: lane * laneWidth + (laneWidth - carWidth) / 2,
    y: -carHeight,
    width: carWidth,
    height: carHeight,
    lane: lane
  };
  enemies.push(enemy);
}

function update() {
  if(!gameRunning) return;

  enemies.forEach(e => e.y += enemySpeed);

  enemies = enemies.filter(e => e.y < canvas.height);

  // Collision detection
  for(let e of enemies){
    if(player.x < e.x + e.width &&
       player.x + player.width > e.x &&
       player.y < e.y + e.height &&
       player.y + player.height > e.y){
         endGame();
    }
  }

  // Increase score and difficulty
  score++;
  if(score % 500 === 0) enemySpeed += 0.5;
  if(score % 1000 === 0 && spawnInterval > 500){
    spawnInterval -= 100;
    clearInterval(spawnTimer);
    spawnTimer = setInterval(spawnEnemy, spawnInterval);
  }

  scoreboard.innerText = "Score: " + score;
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw lane lines
  ctx.strokeStyle = "white";
  ctx.lineWidth = 2;
  for(let i=1;i<laneCount;i++){
    ctx.beginPath();
    ctx.moveTo(i*laneWidth,0);
    ctx.lineTo(i*laneWidth,canvas.height);
    ctx.stroke();
  }

  // Draw player
  ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);

  // Draw enemies
  enemies.forEach(e => {
    ctx.drawImage(enemyImg, e.x, e.y, e.width, e.height);
  });
}

function gameLoop() {
  if(!gameRunning) return;
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

function startGame(firstTime = true){
  buttonsDiv.style.display = "none";
  leaderboardDiv.style.display = "none";

  score = 0;
  enemies = [];
  enemySpeed = 4;
  spawnInterval = 1500;
  gameRunning = true;

  requestAnimationFrame(gameLoop);
  spawnTimer = setInterval(spawnEnemy, spawnInterval);
}

function endGame(){
  gameRunning = false;
  clearInterval(spawnTimer);

  highScores.push(score);
  highScores.sort((a,b)=>b-a);
  highScores = highScores.slice(0,5);
  localStorage.setItem("carGameScores", JSON.stringify(highScores));

  buttonsDiv.style.display = "block";
  startBtn.style.display = "none";
  restartBtn.style.display = "inline-block";

  leaderboardDiv.style.display = "block";
  scoresList.innerHTML = highScores.map(s=>`<li>${s}</li>`).join("");
}

// Keyboard controls
window.addEventListener('keydown', e=>{
  if(!gameRunning) return;
  if(e.key === 'ArrowLeft' && player.lane>0){
    player.lane--;
    player.x = player.lane*laneWidth + (laneWidth - player.width)/2;
  }
  if(e.key === 'ArrowRight' && player.lane<laneCount-1){
    player.lane++;
    player.x = player.lane*laneWidth + (laneWidth - player.width)/2;
  }
});

// Touch controls
let touchStartX = null;
canvas.addEventListener('touchstart', e=>{
  if(!gameRunning) return;
  touchStartX = e.touches[0].clientX;
});
canvas.addEventListener('touchend', e=>{
  if(!gameRunning) return;
  let touchEndX = e.changedTouches[0].clientX;
  if(touchEndX < touchStartX && player.lane>0){
    player.lane--;
  }
  if(touchEndX > touchStartX && player.lane<laneCount-1){
    player.lane++;
  }
  player.x = player.lane*laneWidth + (laneWidth - player.width)/2;
});

startBtn.addEventListener('click', ()=>startGame(true));
restartBtn.addEventListener('click', ()=>startGame(false));
</script>
</body>
</html>
